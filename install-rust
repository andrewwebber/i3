#!/usr/bin/bash -ex
# RUSTFLAGS=-Clinker=musl-gcc
sudo pacman -S rustup --noconfirm
rustup toolchain add stable
rustup toolchain add nightly
for target in "wasm32-wasi" "wasm32-unknown-unknown" "x86_64-unknown-linux-musl" "aarch64-unknown-linux-gnu" "aarch64-unknown-linux-musl" "aarch64-unknown-linux-gnu";
do
    rustup target add $target;
done;
rustup component add rls rust-analysis rust-src clippy
sudo pacman -S rust-analyzer --noconfirm
cargo install cargo-edit
cargo install cargo-tarpaulin
cargo install cargo-expand
cargo install cargo-audit --features=fix
cargo install wasm-pack
mkdir -p ~/.local/bin || true
ln -s /bin/g++ ~/.local/bin/musl-g++
cat << EOF > ~/.cargo/config
[target.aarch64-unknown-linux-gnu]
linker = "aarch64-linux-gnu-gcc"

[target.aarch64-unknown-linux-musl]
linker = "aarch64-linux-gnu-gcc"
EOF
